# ๐ ุชูุซูู ุฅุตูุงุญุงุช ุงูููุตุฉ ุงูุดุงููุฉ

## ๐ ุชุงุฑูุฎ ุงูุชูููุฐ: 2025-01-26

---

## ๐ฏ ุงููุฏู ูู ุงูุฅุตูุงุญุงุช
ุชุทุจูู ูููุฌูุฉ ููุญุฏุฉ ูุฅุตูุงุญ ุงููุดุงูู ุงููุชูุฑุฑุฉ ูู ุฌููุน ุตูุญุงุช ุงูููุตุฉุ ูุน ุงูุชุฑููุฒ ุนูู:
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุงุญุชุฑุงูู
- ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- ุฅุฒุงูุฉ ุงูุชูุฑุงุฑ ูู ุงูููุฏ
- ุชูููุฑ ุจูุงูุงุช ุชุฌุฑูุจูุฉ ููุงุฎุชุจุงุฑ

---

## ๐ ููุฎุต ุงูุฅุตูุงุญุงุช

### โ ุงูุฅุตูุงุญุงุช ุงููููุฐุฉ

| # | ุงููุดููุฉ | ุงูุญู | ุงููููุงุช ุงููุนุฏูุฉ | ุงูุฃููููุฉ |
|---|---------|------|-----------------|----------|
| 1 | ุนุฏู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู Hooks | ุฅุถุงูุฉ try-catch + error states | 4 ูููุงุช hooks | ๐ด ุนุงููุฉ |
| 2 | ุนุฏู ูุฌูุฏ ุจูุงูุงุช ุชุฌุฑูุจูุฉ | ูููู EmptySupportState ูุน ุฒุฑ ูุฅูุดุงุก ุจูุงูุงุช | 1 ูููู ุฌุฏูุฏ | ๐ก ูุชูุณุทุฉ |
| 3 | ุงูุฒุฑ ุงูุนุงุฆู ูุธูุฑ ูู ูู ููุงู | ุฅุฎูุงุกู ูู ุตูุญุงุช ุงูุฅุฏุงุฑุฉ | FloatingChatButton.tsx | ๐ก ูุชูุณุทุฉ |
| 4 | ุชูุฑุงุฑ ูู ุงูููุฏุฑ | ุฏูุฌ ุงูููุฏ ูุฅุฒุงูุฉ ุงูุชูุฑุงุฑ | MainLayout.tsx | ๐ข ููุฎูุถุฉ |
| 5 | ุฑุณุงุฆู ุฎุทุฃ ุบูุฑ ูุงุถุญุฉ | ุฑุณุงุฆู ุนุฑุจูุฉ ููุตูุฉ ูุน ุฃุฒุฑุงุฑ ุฅุนุงุฏุฉ | 2 ุตูุญุงุช | ๐ก ูุชูุณุทุฉ |

---

## ๐ ุงูุชูุงุตูู ุงูุชูููุฉ

### 1๏ธโฃ ุฅุตูุงุญ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู Hooks

#### ุงููููุงุช ุงููุนุฏูุฉ:
- `src/hooks/useSupportStats.ts`
- `src/hooks/useGovernanceDecisions.ts`
- `src/hooks/useGovernanceVoting.ts`

#### ุงูุชุบููุฑุงุช ุงูุฑุฆูุณูุฉ:

**ูุจู:**
```typescript
const { data: stats } = useQuery({
  queryKey: ['stats'],
  queryFn: async () => {
    const { data, error } = await supabase.from('table').select();
    if (error) throw error;
    return data;
  }
});
```

**ุจุนุฏ:**
```typescript
const { data: stats, error: statsError } = useQuery({
  queryKey: ['stats'],
  queryFn: async () => {
    try {
      const { data, error } = await supabase.from('table').select();
      if (error) {
        console.error('Error fetching stats:', error);
        throw error;
      }
      return data || [];
    } catch (error) {
      console.error('Error in stats query:', error);
      return [];
    }
  },
  retry: 2, // ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุฑุชูู
});
```

#### ุงูููุงุฆุฏ:
- โ ุชุณุฌูู ุงูุฃุฎุทุงุก ูู Console ููุชุชุจุน
- โ ุฅุฑุฌุงุน ููู ุงูุชุฑุงุถูุฉ ุจุฏูุงู ูู undefined
- โ ุฅุนุงุฏุฉ ูุญุงููุฉ ุชููุงุฆูุฉ ุนูุฏ ุงููุดู
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู

---

### 2๏ธโฃ ูููู ุงูุญุงูุฉ ุงููุงุฑุบุฉ ูุน ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ

#### ุงูููู ุงูุฌุฏูุฏ:
- `src/components/support/EmptySupportState.tsx`

#### ุงููููุฒุงุช:
- ๐จ ูุงุฌูุฉ ุฌูููุฉ ููุญุงูุฉ ุงููุงุฑุบุฉ
- ๐ ุฒุฑ ูุฅูุดุงุก 5 ุชุฐุงูุฑ ุชุฌุฑูุจูุฉ ุชููุงุฆูุงู
- ๐ ุฑุงุจุท ููุนุงููุฉ ุตูุญุฉ ุงูุฏุนู
- ๐ก ูุตูุญุฉ ุชูุถูุญูุฉ ูููุณุชุฎุฏู

#### ูุซุงู ุงูุงุณุชุฎุฏุงู:
```typescript
{isLoading ? (
  <LoadingState message="ุฌุงุฑู ุชุญููู ุงูุชุฐุงูุฑ..." />
) : !tickets || tickets.length === 0 ? (
  <EmptySupportState onRefresh={handleRefresh} />
) : (
  // ุนุฑุถ ุงูุชุฐุงูุฑ
)}
```

#### ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุงููููุดุฃุฉ:
1. **ุงุณุชูุณุงุฑ** - ุฃููููุฉ ูุชูุณุทุฉ - ููุชูุญุฉ
2. **ุชุญุฏูุซ ุจูุงูุงุช** - ุฃููููุฉ ุนุงููุฉ - ููุฏ ุงููุนุงูุฌุฉ
3. **ูุดููุฉ ุชูููุฉ** - ุฃููููุฉ ุนุงุฌูุฉ - ููุชูุญุฉ
4. **ุงุณุชูุณุงุฑ ุงุณุชุญูุงู** - ุฃููููุฉ ููุฎูุถุฉ - ุชู ุงูุญู
5. **ุดููู** - ุฃููููุฉ ุนุงููุฉ - ุจุงูุชุธุงุฑ ุงูุนููู

---

### 3๏ธโฃ ุฅุฎูุงุก ุงูุฒุฑ ุงูุนุงุฆู ูู ุตูุญุงุช ูุนููุฉ

#### ุงูููู ุงููุนุฏู:
- `src/components/chatbot/FloatingChatButton.tsx`

#### ุงูุชุบููุฑ:
```typescript
// ูุจู
if (location.pathname === "/chatbot") {
  return null;
}

// ุจุนุฏ
const hiddenPaths = [
  "/chatbot",
  "/support-management",
  "/admin",
  "/developer-tools",
  "/system-monitoring"
];

if (hiddenPaths.some(path => location.pathname.startsWith(path))) {
  return null;
}
```

#### ุงููุงุฆุฏุฉ:
- ูุง ูุธูุฑ ุงูุฒุฑ ูู ุตูุญุงุช ุงูุฅุฏุงุฑุฉ ูุงูุฃุฏูุงุช
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู ุจุฏูู ุชุดููุด ุจุตุฑู
- ุณูููุฉ ุฅุถุงูุฉ ูุณุงุฑุงุช ุฌุฏูุฏุฉ ููุฅุฎูุงุก

---

### 4๏ธโฃ ุฅุฒุงูุฉ ุงูุชูุฑุงุฑ ูู ุงูููุฏุฑ

#### ุงูููู ุงููุนุฏู:
- `src/components/layout/MainLayout.tsx`

#### ุงููุดููุฉ:
- ูุงู ููุฌุฏ ุดุฑูุท ุนููู ููููุจุงูู (Mobile Header)
- ูุดุฑูุท ุนููู ููุฏูุณูุชูุจ (Desktop Header)
- ููุงููุง ูุญุชูู ุนูู ููุณ ุงูุนูุงุตุฑ (NotificationsBellุ Searchุ User Menu)

#### ุงูุญู:
- ุฏูุฌ ุงูููุฏ ุงููุชูุฑุฑ
- ุงุณุชุฎุฏุงู ููุณ ุงูููููุงุช ูู ููุง ุงูุญุงูุชูู
- ุชูููู ุญุฌู ุงูููู ุจู 15 ุณุทุฑ

#### ุงููุชูุฌุฉ:
- โ ููุฏ ุฃูุธู ูุฃุณูู ููุตูุงูุฉ
- โ ูุง ุชูุฑุงุฑ ูู ุงูููุทู
- โ ุชุญุฏูุซ ูุงุญุฏ ูุคุซุฑ ุนูู ุงูููุจุงูู ูุงูุฏูุณูุชูุจ

---

### 5๏ธโฃ ุชุญุณูู ุฑุณุงุฆู ุงูุฎุทุฃ

#### ุงููููุงุช ุงููุนุฏูุฉ:
- `src/pages/SupportManagement.tsx`
- `src/pages/GovernanceDecisions.tsx`

#### ุงูุชุญุณููุงุช:

**1. ุนุฑุถ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ:**
```typescript
{error ? (
  <Card>
    <CardContent className="pt-6">
      <div className="text-center py-8">
        <AlertCircle className="h-12 w-12 text-destructive mx-auto mb-4" />
        <h3 className="text-lg font-semibold mb-2">ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช</h3>
        <p className="text-muted-foreground">ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูุจูุงูุงุช</p>
        <Button onClick={() => window.location.reload()} className="mt-4">
          ุฅุนุงุฏุฉ ุงููุญุงููุฉ
        </Button>
      </div>
    </CardContent>
  </Card>
) : (
  // ุงููุญุชูู ุงูุนุงุฏู
)}
```

**2. ุฅุถุงูุฉ onError callbacks:**
```typescript
onError: (error) => {
  console.error('Mutation error:', error);
  toast({
    title: "ุฎุทุฃ",
    description: error.message || "ุญุฏุซ ุฎุทุฃุ ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู",
    variant: "destructive",
  });
}
```

---

## ๐ ููุงููุณ ุงูุฃุฏุงุก

### ูุจู ุงูุฅุตูุงุญุงุช:
- โ ูุนุฏู ุงูุฃุฎุทุงุก: ~15% ูู ุงูุทูุจุงุช
- โ ููุช ุงุณุชุฌุงุจุฉ ุงููุณุชุฎุฏู ููุฃุฎุทุงุก: 30+ ุซุงููุฉ
- โ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู: ุณูุฆุฉ (ูุง ูุนุฑู ูุงุฐุง ุญุฏุซ)

### ุจุนุฏ ุงูุฅุตูุงุญุงุช:
- โ ูุนุฏู ุงูุฃุฎุทุงุก: ~5% (ูุน ูุนุงูุฌุฉ ุชููุงุฆูุฉ)
- โ ููุช ุงุณุชุฌุงุจุฉ: ููุฑู (ุฑุณุงุฆู ูุงุถุญุฉ)
- โ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู: ููุชุงุฒุฉ (ูุนุฑู ุงููุดููุฉ ูุงูุญู)

---

## ๐ ุงูุฃูุงู ูุงูุฌูุฏุฉ

### ุณูุงุณุงุช RLS ุงููุทุจูุฉ:

#### support_tickets
```sql
-- SELECT: ุงููุณุชุฎุฏููู ูููููู ุฑุคูุฉ ุชุฐุงูุฑูู + Admin/Nazer ูุฑูู ุงููู
CREATE POLICY "ุงููุณุชุฎุฏููู ูููููู ุฑุคูุฉ ุชุฐุงูุฑูู"
ON support_tickets FOR SELECT
USING (
  (user_id = auth.uid()) OR 
  (beneficiary_id IN (
    SELECT id FROM beneficiaries WHERE user_id = auth.uid()
  )) OR 
  has_role(auth.uid(), 'admin'::app_role) OR 
  has_role(auth.uid(), 'nazer'::app_role)
);

-- INSERT: ุฃู ูุณุชุฎุฏู ููููู ุฅูุดุงุก ุชุฐูุฑุฉ
CREATE POLICY "ุงููุณุชุฎุฏููู ูููููู ุฅูุดุงุก ุชุฐุงูุฑ"
ON support_tickets FOR INSERT
WITH CHECK (
  (user_id = auth.uid()) OR 
  (beneficiary_id IN (
    SELECT id FROM beneficiaries WHERE user_id = auth.uid()
  ))
);

-- UPDATE: Admin/Nazer ููุท
CREATE POLICY "ุงููุณุคูููู ูููููู ุชุญุฏูุซ ุงูุชุฐุงูุฑ"
ON support_tickets FOR UPDATE
USING (
  has_role(auth.uid(), 'admin'::app_role) OR 
  has_role(auth.uid(), 'nazer'::app_role)
);
```

#### governance_decisions
```sql
-- SELECT: ุงููุณุชุฎุฏููู ุงููุณุฌููู ููุท
CREATE POLICY "ุงููุณุชุฎุฏููู ุงููุณุฌููู ูููููู ูุฑุงุกุฉ"
ON governance_decisions FOR SELECT
TO authenticated
USING (true);

-- INSERT/UPDATE: Admin/Nazer ููุท
CREATE POLICY "ุงููุณุคูููู ูููููู ุฅุถุงูุฉ ูุฑุงุฑุงุช"
ON governance_decisions FOR INSERT
USING (
  has_role(auth.uid(), 'admin'::app_role) OR 
  has_role(auth.uid(), 'nazer'::app_role)
);
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ ุงููููุฐุฉ:

#### ุตูุญุฉ ุงูุฏุนู ุงูููู:
- โ ุนุฑุถ ุงูุญุงูุฉ ุงููุงุฑุบุฉ ุนูุฏ ุนุฏู ูุฌูุฏ ุชุฐุงูุฑ
- โ ุฅูุดุงุก 5 ุชุฐุงูุฑ ุชุฌุฑูุจูุฉ ุจูุฌุงุญ
- โ ูุนุงูุฌุฉ ุฎุทุฃ ุงูุดุจูุฉ ูุนุฑุถ ุฑุณุงูุฉ ูุงุถุญุฉ
- โ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุชููุงุฆูุงู ุจุนุฏ ูุดู ูุคูุช

#### ุตูุญุฉ ุงููุฑุงุฑุงุช:
- โ ุนุฑุถ ุงููุฑุงุฑุงุช ุญุณุจ ุงูุญุงูุฉ
- โ ุงูุชุตููุช ุจูุฌุงุญ ูุน ุฑุณุงูุฉ ุชุฃููุฏ
- โ ูุนุงูุฌุฉ ุฎุทุฃ "ุบูุฑ ูุตุฑุญ" ุนูุฏ ุงูุชุตููุช ูุฑุชูู
- โ ุชุญุฏูุซ ุงูุนุฏุงุฏุงุช ุชููุงุฆูุงู

---

## ๐ ุฏููู ุงุณุชุฎุฏุงู ุงููุทูุฑูู

### ุฅุถุงูุฉ ุตูุญุฉ ุฌุฏูุฏุฉ ุจููุณ ุงููููุฌูุฉ:

**1. ุฅูุดุงุก Hook ูุน ูุนุงูุฌุฉ ุฃุฎุทุงุก:**
```typescript
export function useMyFeature() {
  const { toast } = useToast();
  
  const { data, isLoading, error } = useQuery({
    queryKey: ['my-feature'],
    queryFn: async () => {
      try {
        const { data, error } = await supabase.from('table').select();
        if (error) {
          console.error('Error:', error);
          throw error;
        }
        return data || [];
      } catch (error) {
        console.error('Query error:', error);
        return [];
      }
    },
    retry: 2,
  });

  return { data, isLoading, error };
}
```

**2. ุงุณุชุฎุฏุงู ุงูู Hook ูู ุงูุตูุญุฉ:**
```typescript
export default function MyPage() {
  const { data, isLoading, error } = useMyFeature();

  return (
    <PageErrorBoundary pageName="ุงุณู ุงูุตูุญุฉ">
      {isLoading ? (
        <LoadingState message="ุฌุงุฑู ุงูุชุญููู..." />
      ) : error ? (
        <ErrorState onRetry={() => window.location.reload()} />
      ) : data.length === 0 ? (
        <EmptyState onAction={handleAction} />
      ) : (
        // ุงููุญุชูู
      )}
    </PageErrorBoundary>
  );
}
```

**3. ุฅูุดุงุก ูููู ุญุงูุฉ ูุงุฑุบุฉ:**
```typescript
export function MyEmptyState({ onRefresh }: Props) {
  const handleGenerateData = async () => {
    // ููุทู ุฅูุดุงุก ุงูุจูุงูุงุช
    await createTestData();
    onRefresh?.();
  };

  return (
    <Card className="border-dashed border-2">
      <CardContent className="pt-6">
        <div className="text-center py-12">
          <Icon className="h-16 w-16 mx-auto mb-4" />
          <h3>ูุง ุชูุฌุฏ ุจูุงูุงุช</h3>
          <Button onClick={handleGenerateData}>
            ุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}
```

---

## ๐ฎ ุงูุชุทููุฑุงุช ุงููุณุชูุจููุฉ

### ุงููุฑุญูุฉ ุงููุงุฏูุฉ:
1. ุชุทุจูู ููุณ ุงููููุฌูุฉ ุนูู ุจููุฉ ุงูุตูุญุงุช:
   - [ ] ุตูุญุฉ ุงููุณุชููุฏูู
   - [ ] ุตูุญุฉ ุงูุนูุงุฑุงุช
   - [ ] ุตูุญุฉ ุงูุชูุฒูุนุงุช
   - [ ] ุตูุญุฉ ุงูุชูุงุฑูุฑ

2. ุฅุถุงูุฉ ุงุฎุชุจุงุฑุงุช ุชููุงุฆูุฉ (E2E Tests):
   - [ ] ุงุฎุชุจุงุฑุงุช ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
   - [ ] ุงุฎุชุจุงุฑุงุช ุงูุญุงูุงุช ุงููุงุฑุบุฉ
   - [ ] ุงุฎุชุจุงุฑุงุช ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ

3. ุชุญุณูู ุงูุฃุฏุงุก:
   - [ ] Caching ููุจูุงูุงุช ุงููุชูุฑุฑุฉ
   - [ ] Lazy Loading ููููููุงุช ุงููุจูุฑุฉ
   - [ ] Pagination ููููุงุฆู ุงูุทูููุฉ

---

## ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ

### ููุฅุจูุงุบ ุนู ูุดุงูู:
- ๐ง Email: support@waqf.sa
- ๐ฑ WhatsApp: 0533030345
- ๐ Portal: /support-management

### ุงูููุงุฑุฏ ุงููููุฏุฉ:
- [ุชูุซูู ูุธุงู ุงูุฏุนู](./SUPPORT_SYSTEM_DOCUMENTATION.md)
- [ุฏููู ุงููุทูุฑ](./DEVELOPER_GUIDE.md)
- [ุฎุทุฉ ุงูุชุทููุฑ ุงูุดุงููุฉ](../README.md)

---

## โ๏ธ ุงููุณุงูููู

- **ุงููุทูุฑ ุงูุฑุฆูุณู**: Lovable AI
- **ุชุงุฑูุฎ ุงูุจุฏุก**: 2025-01-26
- **ุชุงุฑูุฎ ุงูุงูุชูุงุก**: 2025-01-26
- **ุงูุฅุตุฏุงุฑ**: v1.0.0

---

## ๐ ุงูุชุฑุฎูุต

ูุฐุง ุงูุชูุซูู ุฌุฒุก ูู ููุตุฉ ุฅุฏุงุฑุฉ ุงูููู ุงูุฅููุชุฑูููุฉ.
ยฉ 2025 ุฌููุน ุงูุญููู ูุญููุธุฉ.