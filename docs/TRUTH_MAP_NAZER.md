# ๐ต๏ธ ุฎุฑูุทุฉ ุงูุญูููุฉ - ููุญุฉ ุงููุงุธุฑ (NazerDashboard)
## Truth Map v1.0.0 - ูุซููุฉ ุงูุชุฏููู ุงูุฌูุงุฆู ุงูุดุงูู

---

## ๐ ููุฎุต ุณุฑูุน

| ุงููููุงุณ | ุงููููุฉ |
|---------|--------|
| ุฅุฌูุงูู ุงูููููุงุช | 26+ |
| ุฅุฌูุงูู ุงูู Hooks | 15 |
| Edge Functions ุงูุญุฑุฌุฉ | 6 |
| ุงูุฌุฏุงูู ุงููุฑุงูุจุฉ (Realtime) | 14 |
| ุฅุนุฏุงุฏุงุช ุงูุชุญูู | 60 (11 ูุฆุฉ) |
| ุงูุชุจููุจุงุช | 4 |
| ูุฑุจุนุงุช ุงูุญูุงุฑ | 4 |

---

## ๐๏ธ ูููู ุงููููุงุช

### ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
```
src/pages/NazerDashboard.tsx (261 ุณุทุฑ)
โโโ ูุธุฑุฉ ุนุงูุฉ (overview)
โโโ ุงููุณุชููุฏูู (beneficiaries)
โโโ ุงูุชูุงุฑูุฑ (reports)
โโโ ุงูุชุญูู (settings)
```

### ุงูููููุงุช
```
src/components/dashboard/nazer/
โโโ NazerKPIs.tsx                    # 9 ูุคุดุฑุงุช ุฃุฏุงุก
โโโ PendingApprovalsSection.tsx      # ุงูููุงููุงุช ุงููุนููุฉ
โโโ SmartAlertsSection.tsx           # ุงูุชูุจููุงุช ุงูุฐููุฉ
โโโ QuickActionsGrid.tsx             # 9 ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ
โโโ NazerOverviewTab.tsx             # ุชุจููุจ ูุธุฑุฉ ุนุงูุฉ
โโโ NazerBeneficiariesTab.tsx        # ุชุจููุจ ุงููุณุชููุฏูู
โโโ NazerReportsSection.tsx          # ูุณู ุงูุชูุงุฑูุฑ
โโโ NazerSettingsTab.tsx             # ุชุจููุจ ุงูุชุญูู

src/components/nazer/
โโโ DistributeRevenueDialog.tsx      # ูุฑุจุน ุชูุฒูุน ุงูุบูุฉ
โโโ PublishFiscalYearDialog.tsx      # ูุฑุจุน ูุดุฑ ุงูุณูุฉ ุงููุงููุฉ
โโโ BeneficiaryActivityMonitor.tsx   # ูุฑุงูุจุฉ ูุดุงุท ุงููุณุชููุฏูู
โโโ ManualTasksCard.tsx              # ุงูููุงู ุงููุฏููุฉ
โโโ RevenueExpenseChart.tsx          # ุฑุณู ุงูุฅูุฑุงุฏุงุช/ุงููุตุฑููุงุช
โโโ BudgetComparisonChart.tsx        # ุฑุณู ููุงุฑูุฉ ุงูููุฒุงููุฉ
โโโ RevenueDistributionChart.tsx     # ุฑุณู ุชูุฒูุน ุงูุฅูุฑุงุฏุงุช
```

---

## ๐ช ุงูู Hooks

### Hooks ุงููุงุธุฑ (src/hooks/nazer/)
| Hook | ุงููุธููุฉ | ููุตุฏููุฑ |
|------|---------|--------|
| `useDistributeRevenue` | ุชูุฒูุน ุงูุบูุฉ ุนูู ุงููุฑุซุฉ | โ |
| `usePublishFiscalYear` | ูุดุฑ ุงูุณูุฉ ุงููุงููุฉ ูููุฑุซุฉ | โ |
| `useBeneficiaryActivitySessions` | ูุฑุงูุจุฉ ุฌูุณุงุช ุงููุณุชููุฏูู | โ |
| `useNazerBeneficiariesQuick` | ูุงุฆูุฉ ุงููุณุชููุฏูู ุงูุณุฑูุนุฉ | โ |
| `useWaqfBranding` | ุฅุฏุงุฑุฉ ุฎุชู ูุชูููุน ุงูููู | โ |

### Hooks ุงูููุญุฉ (src/hooks/dashboard/)
| Hook | ุงููุธููุฉ |
|------|---------|
| `useNazerDashboardRealtime` | ูุฑุงูุจุฉ 14 ุฌุฏูู Realtime |
| `useUnifiedKPIs` | ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูููุญุฏุฉ |
| `useCollectionStats` | ุฅุญุตุงุฆูุงุช ุงูุชุญุตูู |

---

## โก Edge Functions ุงูุญุฑุฌุฉ

### ุงููุธุงุฆู ุงูููุชููุฉ 100%
| ุงููุธููุฉ | Auth | Rate Limit | Audit Log |
|---------|------|------------|-----------|
| `distribute-revenue` | โ JWT + Role | โ 3/ุณุงุนุฉ | โ ูุงูู |
| `publish-fiscal-year` | โ JWT + Role | โ 3/ุณุงุนุฉ | โ ูุงูู |

### ุงููุธุงุฆู ุงููุญุณููุฉ (v2.0.0)
| ุงููุธููุฉ | Auth | Rate Limit | Audit Log |
|---------|------|------------|-----------|
| `daily-notifications` | โ JWT/CRON | โ 5/ุณุงุนุฉ | โ ููุถุงู |
| `weekly-report` | โ JWT/CRON | โ 5/ุณุงุนุฉ | โ ููุถุงู |
| `generate-smart-alerts` | โ JWT/CRON | โ 5/ุณุงุนุฉ | โ ููุถุงู |
| `simulate-distribution` | โ JWT | - (ูุญุงูุงุฉ) | - |

---

## ๐๏ธ ุงูุฌุฏุงูู ุงููุฑุงูุจุฉ (Realtime)

| ุงูุฌุฏูู | ุงูููุน | ุงููุตู |
|--------|-------|-------|
| `beneficiaries` | ุจูุงูุงุช | ุงููุณุชููุฏูู |
| `beneficiary_requests` | ุจูุงูุงุช | ุทูุจุงุช ุงููุณุชููุฏูู |
| `heir_distributions` | ูุงูู | ุชูุฒูุนุงุช ุงููุฑุซุฉ |
| `distribution_details` | ูุงูู | ุชูุงุตูู ุงูุชูุฒูุนุงุช |
| `contracts` | ุนูุงุฑุงุช | ุงูุนููุฏ |
| `rental_payments` | ูุงูู | ุฏูุนุงุช ุงูุฅูุฌุงุฑ |
| `maintenance_requests` | ุนูุงุฑุงุช | ุทูุจุงุช ุงูุตูุงูุฉ |
| `smart_alerts` | ูุธุงู | ุงูุชูุจููุงุช ุงูุฐููุฉ |
| `notifications` | ูุธุงู | ุงูุฅุดุนุงุฑุงุช |
| `approvals` | ุญูููุฉ | ุงูููุงููุงุช |
| `loans` | ูุงูู | ุงููุฑูุถ |
| `loan_installments` | ูุงูู | ุฃูุณุงุท ุงููุฑูุถ |
| `payment_vouchers` | ูุงูู | ุณูุฏุงุช ุงูุฏูุน |
| `fiscal_years` | ูุญุงุณุจุฉ | ุงูุณููุงุช ุงููุงููุฉ |

---

## ๐ ูุคุดุฑุงุช ุงูุฃุฏุงุก (KPIs)

| ุงููุคุดุฑ | ุงููุตุฏุฑ | ุงูููุชุฑ |
|--------|--------|--------|
| ุฅุฌูุงูู ุงููุณุชููุฏูู | `beneficiaries` | `status='ูุดุท'` |
| ุงูุฃุจูุงุก ุงูุฐููุฑ | `beneficiaries` | `category='ุงุจู'` |
| ุงูุจูุงุช | `beneficiaries` | `category='ุงุจูุฉ'` |
| ุฅุฌูุงูู ุงูุชุญุตูู | `payment_vouchers` | `type='receipt', status='paid'` |
| ุงูุนููุฏ ุงููุดุทุฉ | `contracts` | `status='ูุดุท'` |
| ุทูุจุงุช ุงูุตูุงูุฉ ุงูููุชูุญุฉ | `maintenance_requests` | `status NOT IN (...)` |
| ุงูุทูุจุงุช ุงููุนููุฉ | `beneficiary_requests` | `status='ูุนูู'` |
| ุงูุชูุจููุงุช ุงููุดุทุฉ | `smart_alerts` | `status='active'` |
| ุงููุฑูุถ ุงููุชุนุซุฑุฉ | `loans` | `status='defaulted'` |

---

## ๐ ุงูุชุฏููู ุงูุฌูุงุฆู (Audit Trail)

### ุงูุญููู ุงููุทููุจุฉ ูู audit_logs
```typescript
{
  action_type: string;      // ููุน ุงูุนูููุฉ
  table_name: string;       // ุงูุฌุฏูู ุงููุชุฃุซุฑ
  user_id: string;          // ูุนุฑู ุงููุณุชุฎุฏู
  user_email: string;       // ุจุฑูุฏ ุงููุณุชุฎุฏู
  description: string;      // ูุตู ุงูุนูููุฉ
  severity: string;         // ูุณุชูู ุงูุฎุทูุฑุฉ
  ip_address: string;       // ุนููุงู IP
  user_agent: string;       // ูุนูููุงุช ุงููุชุตูุญ
  metadata: object;         // ุจูุงูุงุช ุฅุถุงููุฉ
}
```

### ุฃููุงุน ุงูุนูููุงุช ุงูููุณุฌููุฉ
- `distribute_revenue` - ุชูุฒูุน ุงูุบูุฉ
- `publish_fiscal_year` - ูุดุฑ ุงูุณูุฉ ุงููุงููุฉ
- `daily_notifications` - ุงูุฅุดุนุงุฑุงุช ุงูููููุฉ
- `weekly_report` - ุงูุชูุฑูุฑ ุงูุฃุณุจูุนู
- `generate_smart_alerts` - ุชูููุฏ ุงูุชูุจููุงุช ุงูุฐููุฉ

---

## โ๏ธ ุฅุนุฏุงุฏุงุช ุงูุชุญูู (60 ุฅุนุฏุงุฏ)

### ุงููุฆุงุช (11 ูุฆุฉ)
1. **ุงููุนูููุงุช ุงูุนุงูุฉ** - ุงุณู ุงููููุ ุงูุดุนุงุฑุ ุงูุฎุชู
2. **ุงูุนุฑุถ ูุงููุธูุฑ** - ุงูุซููุ ุงููุบุฉุ ุงูุฎุทูุท
3. **ุงูุฅุดุนุงุฑุงุช** - ุชูุถููุงุช ุงูุฅุดุนุงุฑุงุช
4. **ุงูุฎุตูุตูุฉ** - ุฅุนุฏุงุฏุงุช ุงูุฎุตูุตูุฉ ูููุฑุซุฉ
5. **ุงููุงููุฉ** - ุฅุนุฏุงุฏุงุช ุงููุณุจ ูุงูุชูุฒูุน
6. **ุงููุณุชูุฏุงุช** - ุฅุนุฏุงุฏุงุช PDF ูุงูุชุตุฏูุฑ
7. **ุงูุชูุงุฑูุฑ** - ุฌุฏููุฉ ุงูุชูุงุฑูุฑ
8. **ุงูุชูุงููุงุช** - ุฑุจุท ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ
9. **ุงูุฃูุงู** - 2FAุ ุฌูุณุงุชุ ุณุฌูุงุช
10. **ุงูุตูุงูุฉ** - ูุณุฎ ุงุญุชูุงุทูุ ุชูุธูู
11. **ูุชูุฏู** - ุฅุนุฏุงุฏุงุช ุงููุทูุฑูู

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูุฌูุงุฆู

### Edge Functions
- [x] `distribute-revenue` - Auth + Rate Limit + Audit โ
- [x] `publish-fiscal-year` - Auth + Rate Limit + Audit โ
- [x] `daily-notifications` - Auth + Rate Limit + Audit โ
- [x] `weekly-report` - Auth + Rate Limit + Audit โ
- [x] `generate-smart-alerts` - Auth + Rate Limit + Audit โ

### Hooks
- [x] ุฌููุน Hooks ููุตุฏููุฑุฉ ูู `index.ts` โ

### ุงูุฌุฏุงูู
- [x] RLS ูููุนูู ุนูู ุฌููุน ุงูุฌุฏุงูู โ
- [x] Triggers ููุชุฏููู ูููุนููุฉ โ

---

## ๐ ุณุฌู ุงูุชุบููุฑุงุช

| ุงูุชุงุฑูุฎ | ุงูุฅุตุฏุงุฑ | ุงูุชุบููุฑ |
|---------|---------|---------|
| 2026-01-18 | 1.0.0 | ุฅูุดุงุก ุงููุซููุฉ ุงูุฃูููุฉ |
| 2026-01-18 | 2.0.0 | ุฅุถุงูุฉ Rate Limiting + Audit Logging ูููุธุงุฆู |

---

## ๐ ูููุงุช ุฐุงุช ุตูุฉ

- `docs/UNIFIED_TRUTH_SOURCE.md` - ูุตุงุฏุฑ ุงูุญูููุฉ ุงูููุญุฏุฉ
- `docs/FORENSIC_AUDIT_PLAN.md` - ุฎุทุฉ ุงูุชุฏููู ุงูุฌูุงุฆู
- `src/lib/constants.ts` - ุงูุซูุงุจุช ุงูููุญุฏุฉ
