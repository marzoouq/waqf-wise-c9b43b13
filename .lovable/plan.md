

# ุฎุทุฉ ุฅุตูุงุญ ุซุบุฑุฉ ุงูุชุนููู ุบูุฑ ุงูููุชูู (CVE-Incomplete Sanitization)

## ๐ด ุงููุดููุฉ ุงูููุชุดูุฉ

**ููู:** `supabase/functions/log-error/index.ts`  
**ุงูุณุทุฑ:** 240-242  
**ููุน ุงูุซุบุฑุฉ:** CWE-80 / CWE-116 (ุชุนููู ุบูุฑ ููุชูู ููุฃุญุฑู ุงููุชุนุฏุฏุฉ)  
**ุงูุฎุทูุฑุฉ:** ูุชูุณุทุฉ

### ุงูููุฏ ุงูุญุงูู (ุงููุด):
```typescript
errorReport.error_message = errorReport.error_message
  .replace(/<[^>]*>/g, '')
  .substring(0, 2000);
```

### ุงููุดููุฉ:
ุงูุชุนุจูุฑ ุงูููุทู `/<[^>]*>/g` ูููู ุชุฌุงูุฒู ุจุณูููุฉ:
- ุงููุฏุฎู: `<scr<script>ipt>alert(1)</script>`
- ุจุนุฏ ุงูุชูุธูู: `<script>alert(1)</script>` โ **ูุง ูุฒุงู ุฎุทูุฑุงู!**

---

## โ ุงูุญู ุงูููุชุฑุญ

ุงุณุชุฎุฏุงู ููุชุจุฉ `xss` ุงูููุซููุฉ ูุงูููุฎุชุจุฑุฉ ุฌูุฏุงู ุจุฏูุงู ูู ุงูุชุนุจูุฑ ุงูููุทู ุงูุจุณูุท.

### ุงูุชุบููุฑุงุช ุงููุทููุจุฉ:

#### ุงูุชุบููุฑ 1: ุฅุถุงูุฉ ุงุณุชูุฑุงุฏ ููุชุจุฉ xss (ุงูุณุทุฑ 3)
```typescript
import xss from 'https://esm.sh/xss@1.0.14';
```

#### ุงูุชุบููุฑ 2: ุงุณุชุจุฏุงู ุงูุชุนููู (ุงูุณุทูุฑ 239-242)
```typescript
// ๐งน 7. ุชูุธูู ุฑุณุงุฆู ุงูุฎุทุฃ ูู HTML tags ุจุงุณุชุฎุฏุงู ููุชุจุฉ xss
errorReport.error_message = xss(errorReport.error_message, {
  whiteList: {},              // ุฅุฒุงูุฉ ุฌููุน ูุณูู HTML
  stripIgnoreTag: true,       // ุฅุฒุงูุฉ ุงููุณูู ุบูุฑ ุงููุณููุญุฉ
  stripIgnoreTagBody: ['script', 'style', 'iframe', 'noscript', 'object', 'embed'],
}).substring(0, 2000);
```

---

## ๐ ููุฎุต ุงูุชูููุฐ

| ุงูููู | ุงูุชุบููุฑ | ุงูุบุฑุถ |
|-------|---------|-------|
| `supabase/functions/log-error/index.ts` | ุฅุถุงูุฉ import | ุงุณุชูุฑุงุฏ ููุชุจุฉ xss |
| `supabase/functions/log-error/index.ts` | ุงุณุชุจุฏุงู ุงูุณุทูุฑ 240-242 | ุชุนููู ุขูู |

---

## ๐ ุงูููุงุฆุฏ ุงูุฃูููุฉ

| ูุจู | ุจุนุฏ |
|-----|-----|
| ุชุนุจูุฑ ููุทู ุจุณูุท ูุงุจู ููุชุฌุงูุฒ | ููุชุจุฉ ููุฎุชุจุฑุฉ ุถุฏ XSS |
| ูุง ูุชุนุงูู ูุน ุงููุณูู ุงููุดููุฉ | ูุชุนุงูู ูุน ุฌููุน ุงูุญุงูุงุช |
| ูููู ุญูู `<script>` | ูุฒูู ุฌููุน ุงููุญุชูู ุงูุฎุทูุฑ |

---

## ๐งช ุฃูุซูุฉ ุงูุงุฎุชุจุงุฑ

| ุงููุฏุฎู ุงูุฎุจูุซ | ุงููุชูุฌุฉ ุงููุฏููุฉ | ุงููุชูุฌุฉ ุงูุฌุฏูุฏุฉ |
|---------------|-----------------|-----------------|
| `<scr<script>ipt>alert(1)</script>` | `<script>alert(1)</script>` โ | `alert(1)` โ |
| `<img src=x onerror=alert(1)>` | `` (ูุงุฑุบ) | `` (ูุงุฑุบ) โ |
| `<style>body{display:none}</style>` | `` | `` โ |

---

## โ๏ธ ุงูุชูุงุตูู ุงูุชูููุฉ

### ููุงุฐุง `xss@1.0.14`ุ
- ููุชุจุฉ ูุณุชูุฑุฉ ูููุฎุชุจุฑุฉ
- ุชุฏุนู Deno ุนุจุฑ esm.sh
- ุฅุตุฏุงุฑ ุซุงุจุช ูุถูุงู ุนุฏู ุชุบููุฑ ุงูุณููู

### ุฎูุงุฑุงุช ุงูุชูููู ุงููุณุชุฎุฏูุฉ:
```typescript
{
  whiteList: {},                    // ูุง ูุณูุญ ุจุฃู ูุณูู HTML
  stripIgnoreTag: true,             // ุฅุฒุงูุฉ ุงููุณูู ุจุฏูุงู ูู ุชุฑููุฒูุง
  stripIgnoreTagBody: [             // ุฅุฒุงูุฉ ูุญุชูู ูุฐู ุงููุณูู ุฃูุถุงู
    'script',    // ูุตูุต ุจุฑูุฌูุฉ
    'style',     // ุฃููุงุท CSS
    'iframe',    // ุฅุทุงุฑุงุช ูุถููุฉ
    'noscript',  // ูุญุชูู ุจุฏูู
    'object',    // ูุงุฆูุงุช ูุถููุฉ
    'embed'      // ูุญุชูู ูุถูู
  ]
}
```

