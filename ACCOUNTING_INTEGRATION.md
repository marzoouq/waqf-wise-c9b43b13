# ๐ ุฏููู ุงูุฑุจุท ุงููุญุงุณุจู ุงูุชููุงุฆู

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทุจูู ูุธุงู ุฑุจุท ูุญุงุณุจู ุชููุงุฆู ุดุงูู 100% ูุฑุจุท ุฌููุน ุงูุนูููุงุช ุงููุงููุฉ ุจุงููููุฏ ุงููุญุงุณุจูุฉ ุงูููุงุณุจุฉ ุชููุงุฆูุงู.

---

## ๐ ุฌุฏูู ุฑุจุท ุงูุนูููุงุช ุจุงูุญุณุงุจุงุช

| ุงูุนูููุฉ | ููุน ุงูุญุฏุซ | ุงูุญุณุงุจ ุงููุฏูู | ุงูุญุณุงุจ ุงูุฏุงุฆู | ุงููุตู |
|---------|-----------|---------------|----------------|-------|
| **ุณูุฏ ูุจุถ** | `payment_receipt` | 1.1.1 (ููุฏูุฉ) | 4.1.1 (ุฅูุฑุงุฏุงุช ูุชููุนุฉ) | ุงุณุชูุงู ูุจูุบ ููุฏู |
| **ุณูุฏ ุตุฑู** | `payment_voucher` | 5.1.1 (ูุตุฑููุงุช ุนุงูุฉ) | 1.1.1 (ููุฏูุฉ) | ุตุฑู ูุจูุบ ููุฏู |
| **ุฏูุนุฉ ุฅูุฌุงุฑ** | `rental_payment_received` | 1.1.1 (ููุฏูุฉ) | 4.1.2 (ุฅูุฑุงุฏุงุช ุฅูุฌุงุฑ) | ุงุณุชูุงู ุฅูุฌุงุฑ |
| **ุทูุจ ุตูุงูุฉ** | `maintenance_completed` | 5.2.1 (ูุตุฑููุงุช ุตูุงูุฉ) | 1.1.1 (ููุฏูุฉ) | ุตุฑู ุชูููุฉ ุตูุงูุฉ |
| **ุชูุฒูุน ูุนุชูุฏ** | `distribution_approved` | 5.3.1 (ูุตุฑููุงุช ุชูุฒูุน) | 1.1.1 (ููุฏูุฉ) | ุตุฑู ุชูุฒูุน ูููุณุชููุฏูู |
| **ุฅุตุฏุงุฑ ูุงุชูุฑุฉ** | `invoice_issued` | 1.2.1 (ุนููุงุก) | 4.1.3 (ูุจูุนุงุช) | ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ |
| **ุชุญุตูู ูุงุชูุฑุฉ** | `invoice_paid` | 1.1.1 (ููุฏูุฉ) | 1.2.1 (ุนููุงุก) | ุชุญุตูู ูุจูุบ ุงููุงุชูุฑุฉ |

---

## ๐ ุดุฌุฑุฉ ุงูุญุณุงุจุงุช ุงููุณุชุฎุฏูุฉ

### ุงูุฃุตูู (1)
- **1.1 ุฃุตูู ูุชุฏุงููุฉ**
  - 1.1.1 ุงูููุฏูุฉ (Cash)
  - 1.1.2 ุงูุจูู (Bank)
- **1.2 ุฐูู ูุฏููุฉ**
  - 1.2.1 ุงูุนููุงุก (Accounts Receivable)

### ุงูุฎุตูู (2)
- **2.1 ุฎุตูู ูุชุฏุงููุฉ**
  - 2.1.1 ุฐูู ุฏุงุฆูุฉ

### ุญููู ุงูููููุฉ (3)
- **3.1 ุฑุฃุณ ุงููุงู**
  - 3.1.1 ุฑุฃุณ ูุงู ุงูููู

### ุงูุฅูุฑุงุฏุงุช (4)
- **4.1 ุฅูุฑุงุฏุงุช ุชุดุบูููุฉ**
  - 4.1.1 ุฅูุฑุงุฏุงุช ูุชููุนุฉ
  - 4.1.2 ุฅูุฑุงุฏุงุช ุงูุฅูุฌุงุฑุงุช
  - 4.1.3 ูุจูุนุงุช

### ุงููุตุฑููุงุช (5)
- **5.1 ูุตุฑููุงุช ุนุงูุฉ**
  - 5.1.1 ูุตุฑููุงุช ุฅุฏุงุฑูุฉ
- **5.2 ูุตุฑููุงุช ุงูุตูุงูุฉ**
  - 5.2.1 ุตูุงูุฉ ุนูุงุฑุงุช
- **5.3 ูุตุฑููุงุช ุงูุชูุฒูุนุงุช**
  - 5.3.1 ุชูุฒูุนุงุช ุงููุณุชููุฏูู

---

## ๐ ูุฎุทุท ุชุฏูู ุงููููุฏ ุงูุชููุงุฆูุฉ

```mermaid
graph TD
    A[ุนูููุฉ ูุงููุฉ] --> B{ููุน ุงูุนูููุฉ}
    
    B -->|ุณูุฏ ูุจุถ| C1[ููุฏ ุชููุงุฆู]
    C1 --> D1[ูุฏูู: ููุฏูุฉ<br/>ุฏุงุฆู: ุฅูุฑุงุฏุงุช]
    
    B -->|ุณูุฏ ุตุฑู| C2[ููุฏ ุชููุงุฆู]
    C2 --> D2[ูุฏูู: ูุตุฑููุงุช<br/>ุฏุงุฆู: ููุฏูุฉ]
    
    B -->|ุฏูุนุฉ ุฅูุฌุงุฑ| C3[ููุฏ ุชููุงุฆู]
    C3 --> D3[ูุฏูู: ููุฏูุฉ<br/>ุฏุงุฆู: ุฅูุฑุงุฏุงุช ุฅูุฌุงุฑ]
    
    B -->|ูุงุชูุฑุฉ| C4[ููุฏุงู ุชููุงุฆูุงู]
    C4 --> D4a[1. ูุฏูู: ุนููุงุก<br/>ุฏุงุฆู: ูุจูุนุงุช]
    D4a --> D4b[2. ุนูุฏ ุงูุฏูุน<br/>ูุฏูู: ููุฏูุฉ<br/>ุฏุงุฆู: ุนููุงุก]
    
    B -->|ุตูุงูุฉ| C5[ููุฏ ุชููุงุฆู]
    C5 --> D5[ูุฏูู: ูุตุฑููุงุช ุตูุงูุฉ<br/>ุฏุงุฆู: ููุฏูุฉ]
    
    B -->|ุชูุฒูุน| C6[ูุธุงู ููุงููุงุช 3 ูุณุชููุงุช]
    C6 --> D6[ุนูุฏ ุงูุงุนุชูุงุฏ<br/>ูุฏูู: ูุตุฑููุงุช ุชูุฒูุน<br/>ุฏุงุฆู: ููุฏูุฉ]
    
    D1 & D2 & D3 & D4b & D5 & D6 --> E[ุชุญุฏูุซ ุฃุฑุตุฏุฉ ุงูุญุณุงุจุงุช<br/>Automatic Trigger]
```

---

## ๐ ูุธุงู ุงูููุงููุงุช ุงููุชูุฏู ููุชูุฒูุนุงุช

### ุงููุณุชููุงุช ุงูุซูุงุซุฉ

1. **ุงููุณุชูู ุงูุฃูู: ูุญุงุณุจ (Accountant)**
   - ูุฑุงุฌุนุฉ ุงูุฃุฑูุงู ูุงูุญุณุงุจุงุช
   - ุงูุชุญูู ูู ุชููุฑ ุงูุฃุฑุตุฏุฉ

2. **ุงููุณุชูู ุงูุซุงูู: ูุฏูุฑ ูุงูู (Financial Manager)**
   - ูุฑุงุฌุนุฉ ุงูุฌุฏูู ุงููุงููุฉ
   - ุงูุชุญูู ูู ุงูุงูุชุฒุงู ุจุงูููุฒุงููุฉ

3. **ุงููุณุชูู ุงูุซุงูุซ: ูุงุธุฑ (Admin)**
   - ุงูููุงููุฉ ุงูููุงุฆูุฉ
   - ุงุนุชูุงุฏ ุงูุชูุฒูุน

### ูุณุงุฑ ุงูููุงููุฉ

```mermaid
sequenceDiagram
    participant U as ุงููุณุชุฎุฏู
    participant D as ูุธุงู ุงูุชูุฒูุนุงุช
    participant A1 as ูุญุงุณุจ
    participant A2 as ูุฏูุฑ ูุงูู
    participant A3 as ูุงุธุฑ
    participant J as ูุธุงู ุงููุญุงุณุจุฉ
    
    U->>D: ุฅูุดุงุก ุชูุฒูุน ุฌุฏูุฏ
    D->>D: ุญูุธ ุจุญุงูุฉ "ูุนูู"
    
    D->>A1: ุทูุจ ููุงููุฉ ุงููุณุชูู 1
    A1->>D: ููุงููุฉ โ
    
    D->>A2: ุทูุจ ููุงููุฉ ุงููุณุชูู 2
    A2->>D: ููุงููุฉ โ
    
    D->>A3: ุทูุจ ููุงููุฉ ุงููุณุชูู 3
    A3->>D: ููุงููุฉ โ (ุงุนุชูุงุฏ ููุงุฆู)
    
    D->>D: ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู "ูุนุชูุฏ"
    D->>J: ุฅูุดุงุก ููุฏ ูุญุงุณุจู ุชููุงุฆูุงู
    J->>J: ุชุญุฏูุซ ุฃุฑุตุฏุฉ ุงูุญุณุงุจุงุช
```

---

## ๐ง Triggers ุงููุญุงุณุจูุฉ ุงูุชููุงุฆูุฉ

### 1. Trigger: ุชุญุฏูุซ ุฃุฑุตุฏุฉ ุงูุญุณุงุจุงุช

```sql
CREATE TRIGGER trigger_update_account_balance
AFTER INSERT ON journal_entry_lines
FOR EACH ROW
EXECUTE FUNCTION update_account_balance();
```

**ุงููุธููุฉ:**
- ุนูุฏ ุฅุฏุฑุงุฌ ุณุทุฑ ููุฏ ุฌุฏูุฏ
- ุชุญุฏูุซ ุฑุตูุฏ ุงูุญุณุงุจ ุงููุฏูู (+)
- ุชุญุฏูุซ ุฑุตูุฏ ุงูุญุณุงุจ ุงูุฏุงุฆู (-)

### 2. Trigger: ุชุญุฏูุซ ุญุงูุฉ ุงูุชูุฒูุน

```sql
CREATE TRIGGER trigger_check_approvals
AFTER INSERT OR UPDATE ON distribution_approvals
FOR EACH ROW
EXECUTE FUNCTION check_distribution_approvals();
```

**ุงููุธููุฉ:**
- ุนูุฏ ุฅุถุงูุฉ ููุงููุฉ ุฌุฏูุฏุฉ
- ุงูุชุญูู ูู ุงูุชูุงู ุฌููุน ุงูููุงููุงุช (3 ูุณุชููุงุช)
- ุชุญุฏูุซ ุญุงูุฉ ุงูุชูุฒูุน ุฅูู "ูุนุชูุฏ"
- ุฅูุดุงุก ุงูููุฏ ุงููุญุงุณุจู ุชููุงุฆูุงู

---

## ๐ ุชูุงุฑูุฑ ุงูุฑุจุท ุงููุญุงุณุจู

### 1. ุชูุฑูุฑ ุงูุนูููุงุช ุงููุฑุชุจุทุฉ

ูุนุฑุถ ุฌููุน ุงูุนูููุงุช ุงููุงููุฉ ูุน ุงููููุฏ ุงููุฑุชุจุทุฉ ุจูุง:
- ุงูุณูุฏุงุช
- ุงูุฅูุฌุงุฑุงุช
- ุงูููุงุชูุฑ
- ุงูุตูุงูุฉ
- ุงูุชูุฒูุนุงุช

### 2. ุชูุฑูุฑ ุงูุนูููุงุช ุบูุฑ ุงููุฑุชุจุทุฉ

ููุดู ุนู ุฃู ุนูููุงุช ูู ูุชู ุฅูุดุงุก ูููุฏ ููุง ุชููุงุฆูุงู (ูููุฑุงุฌุนุฉ).

### 3. ุชูุฑูุฑ ุญุฑูุฉ ุงูุญุณุงุจุงุช

ูุนุฑุถ ุชูุตูู ุญุฑูุฉ ูู ุญุณุงุจ ูุน ุงููุตุฏุฑ (payment, invoice, etc.)

---

## ๐ฏ ูุซุงู ุนููู: ุฏูุฑุฉ ุญูุงุฉ ูุงุชูุฑุฉ

```mermaid
graph LR
    A[ุฅูุดุงุก ูุงุชูุฑุฉ<br/>Draft] --> B[ุฅุฑุณุงู ููุนููู<br/>Sent]
    B --> C[ููุฏ ุชููุงุฆู 1]
    C --> D[ูุฏูู: ุนููุงุก<br/>ุฏุงุฆู: ูุจูุนุงุช]
    
    B --> E[ุชุญุตูู ุงููุงุชูุฑุฉ<br/>Paid]
    E --> F[ููุฏ ุชููุงุฆู 2]
    F --> G[ูุฏูู: ููุฏูุฉ<br/>ุฏุงุฆู: ุนููุงุก]
    
    D & G --> H[ุชุญุฏูุซ ุงูุฃุฑุตุฏุฉ<br/>Automatic]
```

### ุงูุฎุทูุงุช:

1. **ุฅูุดุงุก ุงููุงุชูุฑุฉ (Draft)**
   - ูุง ูุชู ุฅูุดุงุก ููุฏ ูุญุงุณุจู

2. **ุฅุฑุณุงู ุงููุงุชูุฑุฉ (Sent)**
   ```typescript
   // ููุฏ ุชููุงุฆู 1: ุฅุซุจุงุช ุงูุฏูู
   ูุฏูู: 1.2.1 (ุนููุงุก)     1,000 ุฑ.ุณ
   ุฏุงุฆู: 4.1.3 (ูุจูุนุงุช)     1,000 ุฑ.ุณ
   ```

3. **ุชุญุตูู ุงููุงุชูุฑุฉ (Paid)**
   ```typescript
   // ููุฏ ุชููุงุฆู 2: ุงุณุชูุงู ุงูููุฏูุฉ
   ูุฏูู: 1.1.1 (ููุฏูุฉ)      1,000 ุฑ.ุณ
   ุฏุงุฆู: 1.2.1 (ุนููุงุก)      1,000 ุฑ.ุณ
   ```

4. **ุชุญุฏูุซ ุงูุฃุฑุตุฏุฉ ุชููุงุฆูุงู**
   - ุฑุตูุฏ ุงูููุฏูุฉ: +1,000 ุฑ.ุณ
   - ุฑุตูุฏ ุงูุนููุงุก: 0 ุฑ.ุณ (ุชู ุงูุชุญุตูู)
   - ุฑุตูุฏ ุงููุจูุนุงุช: +1,000 ุฑ.ุณ

---

## ๐ ุงูุฃูุงู ูุงูุตูุงุญูุงุช

### ุณูุงุณุงุช RLS ุนูู ุฌุฏูู distribution_approvals

```sql
-- ุงููุณุชุฎุฏููู ุงููุตุงุฏููู ูููููู ุงููุฑุงุกุฉ
CREATE POLICY "Authenticated users can view approvals"
ON distribution_approvals FOR SELECT
USING (auth.uid() IS NOT NULL);

-- ุงูุฅุฏุงุฑููู ููุท ูููููู ุงูุฅุฏุงุฑุฉ
CREATE POLICY "Admins can manage approvals"
ON distribution_approvals FOR ALL
USING (has_role(auth.uid(), 'admin'::app_role));
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### ุณููุงุฑูู ุงุฎุชุจุงุฑ 1: ุณูุฏ ูุจุถ

```typescript
// 1. ุฅูุดุงุก ุณูุฏ ูุจุถ
const payment = {
  payment_type: "ูุจุถ",
  amount: 5000,
  payment_date: "2025-01-12",
  description: "ุฅูุฑุงุฏุงุช ูุชููุนุฉ"
};

// 2. ูุชู ุฅูุดุงุก ุงูููุฏ ุชููุงุฆูุงู
// 3. ุชุญุฏูุซ ุงูุฃุฑุตุฏุฉ ุชููุงุฆูุงู
// 4. ุงูุชุญูู ูู ุงูุชูุงุฑูุฑ
```

### ุณููุงุฑูู ุงุฎุชุจุงุฑ 2: ุชูุฒูุน ุจููุงููุงุช

```typescript
// 1. ุฅูุดุงุก ุชูุฒูุน ุฌุฏูุฏ (ุญุงูุฉ: ูุนูู)
const distribution = {
  month: "ูุญุฑู 1446",
  total_amount: 100000,
  beneficiaries_count: 50
};

// 2. ููุงููุฉ ุงููุญุงุณุจ (ุงููุณุชูู 1)
await addApproval({
  distribution_id: dist.id,
  level: 1,
  status: "ููุงูู"
});

// 3. ููุงููุฉ ุงููุฏูุฑ ุงููุงูู (ุงููุณุชูู 2)
await addApproval({
  distribution_id: dist.id,
  level: 2,
  status: "ููุงูู"
});

// 4. ููุงููุฉ ุงููุงุธุฑ (ุงููุณุชูู 3)
await addApproval({
  distribution_id: dist.id,
  level: 3,
  status: "ููุงูู"
});

// 5. ุงูุชุญูู ูู:
// - ุชุญุฏูุซ ุญุงูุฉ ุงูุชูุฒูุน ุฅูู "ูุนุชูุฏ"
// - ุฅูุดุงุก ุงูููุฏ ุงููุญุงุณุจู ุชููุงุฆูุงู
// - ุชุญุฏูุซ ุงูุฃุฑุตุฏุฉ
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ูุงููุคุดุฑุงุช

| ุงููููุงุณ | ุงููููุฉ |
|---------|-------|
| ูุณุจุฉ ุงูุนูููุงุช ุงููุฑุชุจุทุฉ | 100% |
| ุนุฏุฏ ุฃููุงุน ุงูุนูููุงุช ุงููุฏุนููุฉ | 7 |
| ูุณุชููุงุช ุงูููุงููุฉ ููุชูุฒูุนุงุช | 3 |
| Triggers ุชููุงุฆูุฉ | 2 |
| ุชูุงุฑูุฑ ูุชุฎุตุตุฉ | 3 |

---

## ๐ ุฃูุถู ุงูููุงุฑุณุงุช

1. โ **ุฏุงุฆูุงู ุฑุงุฌุน ุงูุชูุงุฑูุฑ**
   - ุชุญูู ูู ุชูุฑูุฑ ุงูุนูููุงุช ุบูุฑ ุงููุฑุชุจุทุฉ ุฃุณุจูุนูุงู

2. โ **ุงูุชุฒู ุจูุณุงุฑ ุงูููุงููุงุช**
   - ูุง ุชุชุฌุงูุฒ ุฃู ูุณุชูู ููุงููุฉ ููุชูุฒูุนุงุช

3. โ **ุฑุงูุจ ุงูุฃุฑุตุฏุฉ**
   - ุชุฃูุฏ ูู ุชุญุฏูุซ ุงูุฃุฑุตุฏุฉ ุชููุงุฆูุงู ุจุนุฏ ูู ุนูููุฉ

4. โ **ูุซูู ุงูููุงููุงุช**
   - ุฃุถู ููุงุญุธุงุช ุชูุถูุญูุฉ ุนูุฏ ุงูููุงููุฉ ุฃู ุงูุฑูุถ

5. โ **ุงุณุชุฎุฏู ุงููุญุงูุงุฉ**
   - ุฌุฑูุจ ูุญุงูุงุฉ ุงูุชูุฒูุน ูุจู ุงูุฅูุดุงุก ุงููุนูู

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูู ูุชู ุฅูุดุงุก ููุฏ ุชููุงุฆูุงู

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
1. ูุง ุชูุฌุฏ ุณูุฉ ูุงููุฉ ูุดุทุฉ
2. ุงูุญุณุงุจุงุช ุงููุญุงุณุจูุฉ ุบูุฑ ููุฌูุฏุฉ
3. ุญุงูุฉ ุงูุนูููุฉ ุบูุฑ ููุงุณุจุฉ

**ุงูุญู:**
1. ุชุฃูุฏ ูู ูุฌูุฏ ุณูุฉ ูุงููุฉ ูุดุทุฉ
2. ุชุญูู ูู ุดุฌุฑุฉ ุงูุญุณุงุจุงุช
3. ุฑุงุฌุน ุงููููุณูู ููุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุชูุฒูุน ูู ููุนุชูุฏ ุฑุบู ุงูููุงููุงุช

**ุงูุณุจุจ:**
- ูู ููุชูู ุนุฏุฏ ุงูููุงููุงุช (3 ูุณุชููุงุช)

**ุงูุญู:**
- ุชุฃูุฏ ูู ูุฌูุฏ 3 ููุงููุงุช ุจุญุงูุฉ "ููุงูู"

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

- [ ] ุฏุนู ุงููููุฏ ุงููุฏููุฉ ุงููุฎุตุตุฉ
- [ ] ุชูุงุฑูุฑ ุชุญููููุฉ ูุชูุฏูุฉ
- [ ] ุฅุดุนุงุฑุงุช ุฐููุฉ ุนูุฏ ุงูููุงููุงุช
- [ ] ุชูุงูู ูุน ุงูุจููู (API)
- [ ] ุชุตุฏูุฑ ูููุงุช ุชุญููู ุจููู (ISO20022)

---

## ๐ ุงูุฏุนู ุงูููู

ููุงุณุชูุณุงุฑุงุช ุญูู ุงูุฑุจุท ุงููุญุงุณุจู:
- ุฑุงุฌุน ูุฐุง ุงููุณุชูุฏ ุฃููุงู
- ุงูุญุต ุงูู Console Logs
- ุชุญูู ูู ุชูุฑูุฑ ุงูุฑุจุท ุงููุญุงุณุจู

---

**ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ:** ูุฑูู ุงูุชุทููุฑ  
**ุขุฎุฑ ุชุญุฏูุซ:** ููุงูุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 1.0.0
