# ๐งช ุงุฎุชุจุงุฑ ุงููุฑุญูุฉ 13: ูุธุงู ุงููุตุงุฏูุฉ ูุงูุฃุฏูุงุฑ

## โ ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ
- [ ] ุงูุชุญ `/signup`
- [ ] ุฃุฏุฎู: ุงูุงุณู ุงููุงููุ ุงูุจุฑูุฏ ุงูุฅููุชุฑูููุ ูููุฉ ุงููุฑูุฑ
- [ ] ุงููุฑ "ุฅูุดุงุก ุญุณุงุจ"
- [ ] ุชุญูู ูู ุฅูุดุงุก ุญุณุงุจ ูู ุฌุฏูู `profiles`
- [ ] ุชุญูู ูู ุชุนููู ุฏูุฑ "ูุณุชููุฏ" ุชููุงุฆูุงู
- [ ] ุชุญูู ูู ุงูุชูุฌูู ูุตูุญุฉ `/login`

### 2. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู
- [ ] ุงูุชุญ `/login`
- [ ] ุฃุฏุฎู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงููุฑูุฑ
- [ ] ุงููุฑ "ุชุณุฌูู ุงูุฏุฎูู"
- [ ] ุชุญูู ูู ุงูุชูุฌูู ูู `/dashboard`
- [ ] ุชุญูู ูู ุนุฑุถ ุจูุงูุงุช ุงููุณุชุฎุฏู ุจุดูู ุตุญูุญ

### 3. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฎุฑูุฌ
- [ ] ุงููุฑ ุนูู ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ (ูู ุงูู Header)
- [ ] ุชุญูู ูู ุงูุชูุฌูู ูู `/login`
- [ ] ุชุญูู ูู ุญุฐู ุงูุฌูุณุฉ

### 4. ุงุฎุชุจุงุฑ ุญูุงูุฉ ุงููุณุงุฑุงุช
- [ ] ุณุฌู ุฎุฑูุฌ
- [ ] ุญุงูู ุงููุตูู ูู `/dashboard` ูุจุงุดุฑุฉ
- [ ] ุชุญูู ูู ุงูุชูุฌูู ุงูุชููุงุฆู ูู `/login`
- [ ] ุณุฌู ุฏุฎูู
- [ ] ุชุญูู ูู ุงูุชูุฌูู ูู `/dashboard`

### 5. ุงุฎุชุจุงุฑ ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช
#### ุฏูุฑ "ูุณุชููุฏ"
- [ ] ุณุฌู ุฏุฎูู ููุณุชููุฏ
- [ ] ุชุญูู ูู ุงููุตูู ูู `/dashboard`
- [ ] ุญุงูู ุงููุตูู ูู `/users` (ูุฌุจ ุฑูุถ ุงููุตูู)
- [ ] ุญุงูู ุงููุตูู ูู `/beneficiaries` (ูุฌุจ ุฑูุถ ุงููุตูู)
- [ ] ุชุญูู ูู ุงูุชูุฌูู ูู `/unauthorized`

#### ุฏูุฑ "ูุญุงุณุจ"
- [ ] ุบูุฑ ุฏูุฑ ูุณุชุฎุฏู ูู "accountant" ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- [ ] ุณุฌู ุฏุฎูู
- [ ] ุชุญูู ูู ุงููุตูู ูู `/accounting` โ
- [ ] ุชุญูู ูู ุงููุตูู ูู `/beneficiaries` โ
- [ ] ุญุงูู ุงููุตูู ูู `/users` (ูุฌุจ ุฑูุถ ุงููุตูู) โ

#### ุฏูุฑ "ูุงุธุฑ"
- [ ] ุบูุฑ ุฏูุฑ ูุณุชุฎุฏู ูู "nazer"
- [ ] ุณุฌู ุฏุฎูู
- [ ] ุชุญูู ูู ุงููุตูู ููู ุงูุตูุญุงุช โ
- [ ] ุชุญูู ูู ุตูุงุญูุฉ "*" (ูู ุงูุตูุงุญูุงุช)

### 6. ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช ุงููุฎุตุตุฉ
- [ ] ุงูุชุญ `/users`
- [ ] ุงุฎุชุฑ ูุณุชุฎุฏู
- [ ] ุฃุถู ุตูุงุญูุฉ ูุฎุตุตุฉ (ูุซู: `reports.view`)
- [ ] ุงููุญ ุงูุตูุงุญูุฉ = `true`
- [ ] ุณุฌู ุฏุฎูู ุจุฐูู ุงููุณุชุฎุฏู
- [ ] ุชุญูู ูู ูุตููู ูุตูุญุฉ ุงูุชูุงุฑูุฑ

### 7. ุงุฎุชุจุงุฑ RLS Policies
#### ุฌุฏูู `roles`
- [ ] ุณุฌู ุฏุฎูู ููุณุชููุฏ
- [ ] ุญุงูู ูุฑุงุกุฉ ุงูุฃุฏูุงุฑ (ูุฌุจ ุงููุฌุงุญ - ููุฌููุน)
- [ ] ุญุงูู ุฅุถุงูุฉ ุฏูุฑ ุฌุฏูุฏ (ูุฌุจ ุงููุดู - ูููุดุฑููู ููุท)

#### ุฌุฏูู `profiles`
- [ ] ุณุฌู ุฏุฎูู ููุณุชุฎุฏู ุนุงุฏู
- [ ] ุญุงูู ูุฑุงุกุฉ ูููู ุงูุดุฎุตู (ูุฌุจ ุงููุฌุงุญ)
- [ ] ุญุงูู ูุฑุงุกุฉ ููู ูุณุชุฎุฏู ุขุฎุฑ (ูุฌุจ ุงููุดู)
- [ ] ุณุฌู ุฏุฎูู ููุดุฑู
- [ ] ุญุงูู ูุฑุงุกุฉ ุฃู ููู (ูุฌุจ ุงููุฌุงุญ)

#### ุฌุฏูู `user_permissions`
- [ ] ุญุงูู ูุฑุงุกุฉ ุตูุงุญูุงุชู (ูุฌุจ ุงููุฌุงุญ)
- [ ] ุญุงูู ูุฑุงุกุฉ ุตูุงุญูุงุช ูุณุชุฎุฏู ุขุฎุฑ (ูุฌุจ ุงููุดู)
- [ ] ุณุฌู ุฏุฎูู ููุดุฑู
- [ ] ุญุงูู ุฅุถุงูุฉ ุตูุงุญูุงุช ููุณุชุฎุฏู (ูุฌุจ ุงููุฌุงุญ)

### 8. ุงุฎุชุจุงุฑ ุฏุงูุฉ `check_user_permission`
ุงูุชุญ Supabase SQL Editor ูุฌุฑุจ:
```sql
-- ุชุญูู ูู ุตูุงุญูุฉ ุงููุงุธุฑ (ูุฌุจ true ููู ุดูุก)
SELECT public.check_user_permission(
  'user_id_here',
  'any_permission'
);

-- ุชุญูู ูู ุตูุงุญูุฉ ูุญุฏุฏุฉ
SELECT public.check_user_permission(
  'user_id_here',
  'accounting.manage'
);
```

### 9. ุงุฎุชุจุงุฑ ุงูุฃุฎุทุงุก
- [ ] ุณุฌู ุฏุฎูู ุจุจุฑูุฏ ุฅููุชุฑููู ุฎุงุทุฆ
- [ ] ุณุฌู ุฏุฎูู ุจูููุฉ ูุฑูุฑ ุฎุงุทุฆุฉ
- [ ] ุฃูุดุฆ ุญุณุงุจ ุจุจุฑูุฏ ุฅููุชุฑููู ููุฌูุฏ
- [ ] ุฃูุดุฆ ุญุณุงุจ ุจูููุฉ ูุฑูุฑ ุฃูู ูู 6 ุฃุญุฑู
- [ ] ุชุญูู ูู ุฑุณุงุฆู ุงูุฎุทุฃ ุงููุงุถุญุฉ

### 10. ุงุฎุชุจุงุฑ ุงูุชูุงูู
- [ ] ุณุฌู ุฏุฎูู ููุญุงุณุจ
- [ ] ุงูุชุญ `/beneficiaries`
- [ ] ุชุญูู ูู ุนุฑุถ ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ
- [ ] ุฃุถู ูุณุชููุฏ ุฌุฏูุฏ
- [ ] ุชุญูู ูู ุญูุธ ุงูุจูุงูุงุช
- [ ] ุชุญูู ูู ุณุฌู ุงููุดุงุท ูู `audit_logs`

## ๐ ุงุฎุชุจุงุฑุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุชุญูู ูู ุงูุจูุงูุงุช
```sql
-- ุนุฑุถ ูู ุงูุฃุฏูุงุฑ
SELECT * FROM roles;

-- ุนุฑุถ ูู ุงููุณุชุฎุฏููู ูุฃุฏูุงุฑูู
SELECT 
  p.full_name,
  p.email,
  r.role_name_ar,
  r.permissions
FROM profiles p
LEFT JOIN roles r ON r.id = p.role_id;

-- ุนุฑุถ ุงูุตูุงุญูุงุช ุงููุฎุตุตุฉ
SELECT 
  p.full_name,
  up.permission_key,
  up.granted
FROM user_permissions up
JOIN profiles p ON p.id = up.user_id;

-- ุนุฑุถ ุงูุฌูุณุงุช ุงููุดุทุฉ
SELECT 
  p.full_name,
  us.started_at,
  us.last_activity_at
FROM user_sessions us
JOIN profiles p ON p.id = us.user_id
WHERE us.ended_at IS NULL;
```

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### โ ุงููุฌุงุญ
- ูููู ุฅูุดุงุก ุญุณุงุจุงุช ุฌุฏูุฏุฉ
- ูููู ุชุณุฌูู ุงูุฏุฎูู ูุงูุฎุฑูุฌ
- ุงููุณุงุฑุงุช ูุญููุฉ ุจุดูู ุตุญูุญ
- ุงูุฃุฏูุงุฑ ุชุนูู ููุง ูู ูุชููุน
- RLS Policies ุชููุน ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู
- ุฑุณุงุฆู ุงูุฎุทุฃ ูุงุถุญุฉ ููููุฏุฉ

### โ ุงููุดู
- ุนุฏู ุงููุฏุฑุฉ ุนูู ุชุณุฌูู ุงูุฏุฎูู
- ุงููุตูู ูุตูุญุงุช ุบูุฑ ูุตุฑุญ ุจูุง
- RLS Policies ูุง ุชุนูู
- ุฃุฎุทุงุก ูู ุงููููุณูู
- ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ

## ๐ ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ ูุญููููุง

### 1. "Cannot read properties of null"
**ุงูุณุจุจ**: profile ูู ูุชู ุชุญูููู
**ุงูุญู**: ุชุญูู ูู trigger `handle_new_user`

### 2. "Access denied"
**ุงูุณุจุจ**: RLS Policy ุชุฑูุถ ุงููุตูู
**ุงูุญู**: ุชุญูู ูู ุฏูุฑ ุงููุณุชุฎุฏู ูุงูุตูุงุญูุงุช

### 3. "Redirecting to /login in loop"
**ุงูุณุจุจ**: AuthContext ูุง ูุชุนุฑู ุนูู ุงููุณุชุฎุฏู
**ุงูุญู**: ุชุญูู ูู session ูู localStorage

### 4. "role_id is null"
**ุงูุณุจุจ**: ุงูู trigger ูู ูุนูู ุงูุฏูุฑ
**ุงูุญู**: ูู ุจุชุนููู ุฏูุฑ ูุฏููุงู ูููุณุชุฎุฏููู ุงูููุฌูุฏูู

## โ๏ธ ุณุฌู ุงูุงุฎุชุจุงุฑุงุช

| ุงูุงุฎุชุจุงุฑ | ุงููุชูุฌุฉ | ููุงุญุธุงุช | ุงูุชุงุฑูุฎ |
|---------|---------|---------|---------|
| ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ | โฌ | | |
| ุชุณุฌูู ุงูุฏุฎูู | โฌ | | |
| ุชุณุฌูู ุงูุฎุฑูุฌ | โฌ | | |
| ุญูุงูุฉ ุงููุณุงุฑุงุช | โฌ | | |
| ุตูุงุญูุงุช ุงููุงุธุฑ | โฌ | | |
| ุตูุงุญูุงุช ุงููุญุงุณุจ | โฌ | | |
| ุตูุงุญูุงุช ุงููุณุชููุฏ | โฌ | | |
| RLS Policies | โฌ | | |
| ุงูุตูุงุญูุงุช ุงููุฎุตุตุฉ | โฌ | | |
| ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก | โฌ | | |

**ุงุจุฏุฃ ุงูุงุฎุชุจุงุฑ ุงูุขู!** ๐
